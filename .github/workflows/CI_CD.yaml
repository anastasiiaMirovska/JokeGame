
name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: –ö–ª–æ–Ω—É—î–º–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
        uses: actions/checkout@v4

      - name: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è .env –¥–ª—è –±–µ–∫–µ–Ω–¥—É
        run: echo "${{ secrets.BACKEND_ENV }}" > backend/.env

      - name: üõ† –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –±–µ–∫–µ–Ω–¥—É
        run: cd backend && npm ci

      - name: –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤
        run: docker compose up -d --build

      - name: ‚è≥ –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø—ñ–¥–Ω—è—Ç—Ç—è MongoDB
        run: |
          echo "Waiting for MongoDB to start..."
          until nc -z db 27017; do sleep 1; done
          echo "MongoDB is up!"

      - name: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤
        run: cd backend && npm run test


